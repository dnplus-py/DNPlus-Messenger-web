<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNPlus - Verificación</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body style="background-color: #176f47; color: white; font-family: sans-serif; text-align: center; padding-top: 50px;">

    <h1>DNPlus</h1>
    <p>Ingresa tu correo para recibir el código</p>

    <input type="email" id="user-email" placeholder="tu@email.com" 
           style="padding: 10px; border-radius: 5px; border: none; width: 80%; max-width: 300px;">
    
    <br><br>

    <button id="btn-enviar" onclick="procesarEnvio()" 
            style="background-color: #F08927; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
        <span id="btn-texto">OBTENER CÓDIGO</span>
    </button>

    <script>
        // Inicializamos con tu Public Key ✅
        (function() {
            emailjs.init("Ycta0gV4PbOTe1hr9"); 
        })();

        function procesarEnvio() {
            const emailIngresado = document.getElementById('user-email').value;
            const boton = document.getElementById('btn-enviar');
            const textoBoton = document.getElementById('btn-texto');
            
            if (!emailIngresado.includes("@")) {
                alert("Por favor, ingresa un correo válido.");
                return;
            }

            // Bloqueamos el botón para evitar múltiples clics
            textoBoton.innerText = "ENVIANDO...";
            boton.disabled = true;

            // Generamos el código de 6 dígitos
            const codigoOTP = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem("codigo_verificacion", codigoOTP);

            // CONFIGURACIÓN QUE DIO 200 OK ✅
            const serviceID = 'service_eakuydh'; 
            const templateID = 'template_7nnvz18'; 

            const templateParams = {
                email: emailIngresado, // Nombre de variable en tu plantilla
                passcode: codigoOTP,   // Nombre de variable en tu plantilla
                time: "One-Time password"
            };

            // Envío del correo
            emailjs.send(serviceID, templateID, templateParams)
                .then(() => {
                    // Si el envío es exitoso, vamos a la pantalla del OTP
                    window.location.href = "otp.html";
                }, (err) => {
                    // Si hay error, liberamos el botón
                    textoBoton.innerText = "REINTENTAR";
                    boton.disabled = false;
                    alert("Error al enviar: " + JSON.stringify(err));
                });
        }
    </script>
</body>
</html>
