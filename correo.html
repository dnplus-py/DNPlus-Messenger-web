<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNPlus - Vincular Correo</title>
    <style>
        body { background-color: #0b141a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; padding: 20px; }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .icon-mail { font-size: 50px; color: #176F47; margin-bottom: 20px; }
        h2 { margin-bottom: 10px; font-size: 22px; }
        p { color: #8696a0; font-size: 14px; margin-bottom: 30px; }
        .input-group { background: #202c33; border-radius: 10px; padding: 10px; margin-bottom: 20px; border-bottom: 2px solid #176F47; }
        input { background: transparent; border: none; color: white; width: 100%; padding: 10px; font-size: 16px; outline: none; }
        .btn-enviar { background-color: #176F47; color: white; border: none; width: 100%; padding: 15px; border-radius: 50px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; width: 100%; }
        .btn-enviar:disabled { background-color: #202c33; color: #8696a0; }
    </style>
</head>
<body>

    <div class="container">
        <div class="icon-mail">üìß</div>
        <h2>A√±ade tu correo</h2>
        <p>Te enviaremos un c√≥digo de 6 d√≠gitos para verificar tu cuenta de DNPlus.</p>
        <div class="input-group">
            <input type="email" id="user-email" placeholder="ejemplo@gmail.com">
        </div>
        <button class="btn-enviar" id="btn-enviar" onclick="procesarEnvio()">ENVIAR C√ìDIGO</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        (function() {
            // TU KEY P√öBLICA (Verifica que sea esta en Account > Public Key)
            emailjs.init("RyMkpjIKl84V_buAq"); 
        })();

        function procesarEnvio() {
            const email = document.getElementById('user-email').value.trim();
            const boton = document.getElementById('btn-enviar');
            
            if (!email.includes("@")) {
                alert("Ingresa un correo v√°lido");
                return;
            }

            boton.innerText = "PROBANDO CONEXI√ìN...";
            boton.disabled = true;

            const codigoOTP = Math.floor(100000 + Math.random() * 900000).toString();
            
            // Guardamos para la siguiente pantalla
            localStorage.setItem("user_email", email);
            localStorage.setItem("temp_otp", codigoOTP);

            // DATOS DE PRUEBA - Aseg√∫rate de que coincidan con tu panel
            const serviceID = 'default_service'; 
            const templateID = 'template_XXXXXX'; // <--- DAVID: AQU√ç EST√Å EL ERROR SEGURO.

            const templateParams = {
                to_email: email,
                otp_code: codigoOTP
            };

            emailjs.send(serviceID, templateID, templateParams)
                .then(() => {
                    alert("¬°C√≥digo enviado con √©xito!");
                    window.location.href = "otp.html";
                })
                .catch((err) => {
                    // ESTO NOS DAR√Å LA PISTA FINAL
                    console.error("DETALLE DEL ERROR:", err);
                    alert("ERROR DETALLADO: " + err.status + " - " + err.text);
                    boton.innerText = "REINTENTAR";
                    boton.disabled = false;
                });
        }
    </script>
</body>
</html>
