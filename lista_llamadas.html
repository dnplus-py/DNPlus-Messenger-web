<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNPlus - Contactos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #0b141a; color: #e9edef; }
        
        header { 
            height: 60px; background-color: #202c33; display: flex; 
            align-items: center; padding: 0 15px; gap: 20px; position: sticky; top: 0; z-index: 50;
        }

        .contact-item { 
            display: flex; align-items: center; padding: 12px 16px; gap: 15px; 
            cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); 
        }
        .contact-item:active { background-color: #202c33; }
        
        .avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; background: #232d36; }
        
        .info { flex: 1; }
        .name { font-weight: 500; font-size: 16px; }
        .status { color: #8696a0; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* BOTÓN FLOTANTE (FAB) */
        .fab-add {
            position: fixed;
            bottom: 30px;
            right: 25px;
            background-color: #00a884;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            cursor: pointer;
            z-index: 100;
            color: #0b141a;
            font-size: 20px;
            transition: transform 0.2s;
        }
        .fab-add:active { transform: scale(0.9); }

        .section-title { padding: 15px 16px 8px; color: #8696a0; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
    </style>
</head>
<body>

    <header>
        <i class="fas fa-arrow-left cursor-pointer" onclick="history.back()"></i>
        <div>
            <h1 class="text-lg font-medium leading-tight">Seleccionar contacto</h1>
            <p class="text-xs text-[#8696a0]" id="count-contactos">Cargando...</p>
        </div>
    </header>

    <div id="lista-contactos">
        <div class="flex justify-center items-center h-40">
            <p class="text-[#8696a0] animate-pulse">Buscando contactos...</p>
        </div>
    </div>

    <div class="fab-add" onclick="location.href='crear_new_contacto.html'">
        <i class="fas fa-user-plus"></i>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD2nZF5QC-Zti80xP1A518qbUPnhRru_9A",
            databaseURL: "https://dnplus-messenger-pro-default-rtdb.firebaseio.com",
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function cargarContactos() {
            db.ref("usuarios_registrados").on("value", snapshot => {
                const container = document.getElementById("lista-contactos");
                const countLabel = document.getElementById("count-contactos");
                container.innerHTML = "";
                
                if (!snapshot.exists()) {
                    container.innerHTML = "<p class='p-5 text-center text-[#8696a0]'>No hay contactos aún.</p>";
                    countLabel.innerText = "0 contactos";
                    return;
                }

                let total = 0;
                snapshot.forEach(child => {
                    const user = child.val();
                    total++;
                    
                    const item = document.createElement("div");
                    item.className = "contact-item";
                    item.onclick = () => {
                        // Aquí podrías redirigir al chat con este usuario
                        localStorage.setItem("chat_con", user.telefono);
                        location.href = "chat.html";
                    };
                    
                    item.innerHTML = `
                        <img src="${user.foto || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" class="avatar">
                        <div class="info">
                            <div class="name">${user.nombre}</div>
                            <div class="status">${user.bio || '¡Hola! Estoy usando DNPlus.'}</div>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                countLabel.innerText = total + " contactos";
            });
        }

        window.onload = cargarContactos;
    </script>
</body>
</html>
