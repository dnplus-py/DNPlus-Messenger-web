<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNPlus - Home</title>
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #0b141a; color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* HEADER Y TABS */
        .header { background-color: #085f56; padding: 10px 15px 0 15px; flex-shrink: 0; }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
        .header-top h1 { margin: 0; font-size: 22px; color: #e9edef; }
        .tabs { display: flex; text-align: center; font-weight: bold; font-size: 14px; color: #8696a0; }
        .tab { flex: 1; padding: 12px 0; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab.active { color: #00a884; border-bottom: 3px solid #00a884; }

        /* CONTENIDO */
        .content-section { flex: 1; overflow-y: scroll; -webkit-overflow-scrolling: touch; display: none; padding-bottom: 100px; }
        .content-section.active { display: block; }

        /* ESTILO ITEMS */
        .item { display: flex; align-items: center; padding: 15px; gap: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; background: #2a3942; object-fit: cover; }
        .info { flex: 1; }
        .nombre { font-size: 16px; font-weight: bold; }
        .subtext { font-size: 14px; color: #8696a0; }

        /* CIRCULO VERDE EN ESTADO */
        .status-circle { border: 2.5px solid #00a884; border-radius: 50%; padding: 2px; display: flex; align-items: center; justify-content: center; }

        /* VISOR DE ESTADOS FULLSCREEN */
        #status-viewer {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 5000; flex-direction: column;
        }
        .status-progress-bar { display: flex; gap: 5px; padding: 10px; position: absolute; top: 0; width: 100%; box-sizing: border-box; }
        .progress-bg { flex: 1; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: white; width: 0%; }
        .status-header { display: flex; align-items: center; gap: 10px; padding: 20px 15px; margin-top: 10px; z-index: 10; }
        .status-content { flex: 1; display: flex; align-items: center; justify-content: center; }
        .status-content img, .status-content video { max-width: 100%; max-height: 100%; }
        .status-text-bg { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 32px; padding: 30px; text-align: center; }

        /* BOTONES */
        .fab { position: fixed; bottom: 20px; right: 20px; background: #00a884; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 999; }
        .fab-text { bottom: 90px; right: 25px; background: #232d36; width: 45px; height: 45px; font-size: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-top">
            <h1>DNPlus</h1>
            <div style="display: flex; gap: 20px; font-size: 18px;"><span>üîç</span><span onclick="toggleMenu()">‚ãÆ</span></div>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chats', this)">CHATS</div>
            <div class="tab" onclick="switchTab('estados', this)">ESTADOS</div>
            <div class="tab" onclick="switchTab('llamadas', this)">LLAMADAS</div>
        </div>
    </div>

    <div id="sec-estados" class="content-section">
        <div class="item" onclick="document.getElementById('file-status').click()">
            <div style="position: relative;">
                <img id="mi-foto-est" class="avatar" src="">
                <div style="position:absolute; bottom:0; right:0; background:#00a884; border-radius:50%; width:18px; height:18px; border:2px solid #0b141a; font-size:14px; text-align:center;">+</div>
            </div>
            <div class="info">
                <div class="nombre">Mi estado</div>
                <div class="subtext">Toca para a√±adir un estado</div>
            </div>
        </div>
        <div class="subtext" style="padding: 10px 15px; background: rgba(255,255,255,0.03);">RECIENTES</div>
        <div id="lista-estados-fb"></div>
        
        <div class="fab fab-text" onclick="crearEstadoTexto()">‚úèÔ∏è</div>
        <div class="fab" onclick="document.getElementById('file-status').click()">üì∑</div>
        <input type="file" id="file-status" hidden accept="image/*,video/*" onchange="subirArchivoEstado(event)">
    </div>

    <div id="status-viewer">
        <div class="status-progress-bar"><div class="progress-bg"><div id="p-fill" class="progress-fill"></div></div></div>
        <div class="status-header">
            <span onclick="cerrarVisor()" style="font-size:24px;">‚Üê</span>
            <img id="v-avatar" class="avatar" style="width:40px; height:40px;">
            <div class="nombre" id="v-nombre">Nombre</div>
        </div>
        <div class="status-content" id="v-content"></div>
    </div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

<script>
    // Tu Configuraci√≥n de Firebase...
    const db = firebase.database();

    // SUBIR FOTO/VIDEO A ESTADO
    function subirArchivoEstado(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
            db.ref("estados").push({
                user: localStorage.getItem("user_name") || "David",
                fotoUser: localStorage.getItem("user_photo") || "",
                tipo: file.type.includes("video") ? "video" : "imagen",
                contenido: reader.result,
                fecha: Date.now()
            });
        };
    }

    // CARGAR ESTADOS CON VISOR
    db.ref("estados").on("value", snap => {
        const list = document.getElementById('lista-estados-fb');
        list.innerHTML = "";
        snap.forEach(child => {
            const est = child.val();
            const div = document.createElement('div');
            div.className = "item";
            div.onclick = () => abrirVisor(est);
            div.innerHTML = `
                <div class="status-circle">
                    <img class="avatar" src="${est.fotoUser || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:45px; height:45px;">
                </div>
                <div class="info">
                    <div class="nombre">${est.user}</div>
                    <div class="subtext">Justo ahora</div>
                </div>`;
            list.appendChild(div);
        });
    });

    let stInterval;
    function abrirVisor(est) {
        const visor = document.getElementById('status-viewer');
        const content = document.getElementById('v-content');
        const fill = document.getElementById('p-fill');
        
        document.getElementById('v-nombre').innerText = est.user;
        document.getElementById('v-avatar').src = est.fotoUser;
        
        content.innerHTML = "";
        if(est.tipo === "texto") {
            content.innerHTML = `<div class="status-text-bg" style="background:${est.fondo}">${est.contenido}</div>`;
        } else if(est.tipo === "video") {
            content.innerHTML = `<video src="${est.contenido}" autoplay></video>`;
        } else {
            content.innerHTML = `<img src="${est.contenido}">`;
        }

        visor.style.display = 'flex';
        fill.style.width = '0%';
        let p = 0;
        stInterval = setInterval(() => {
            p += 1;
            fill.style.width = p + '%';
            if(p >= 100) cerrarVisor();
        }, 50); // 5 segundos aprox
    }

    function cerrarVisor() {
        document.getElementById('status-viewer').style.display = 'none';
        clearInterval(stInterval);
    }
    
    // Al cargar, poner tu foto de perfil
    document.getElementById('mi-foto-est').src = localStorage.getItem("user_photo") || "";
</script>
</body>
</html>
