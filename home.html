<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNPlus Messenger</title>
    <style>
        :root {
            --fondo: #0b141a;
            --verde: #00a884;
            --header: #202c33;
            --texto: #e9edef;
            --gris: #8696a0;
        }

        body { margin: 0; font-family: sans-serif; background-color: var(--fondo); color: var(--texto); overflow: hidden; }

        /* HEADER PRINCIPAL */
        .header { background-color: var(--header); padding: 10px 15px; display: flex; flex-direction: column; gap: 10px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { color: var(--gris); font-size: 20px; font-weight: bold; }
        .icons { display: flex; gap: 20px; font-size: 20px; color: var(--gris); cursor: pointer; }

        /* BUSCADOR REAL */
        .search-bar { background: var(--fondo); border-radius: 20px; padding: 8px 15px; display: flex; align-items: center; gap: 10px; margin: 5px 0; }
        .search-bar input { background: transparent; border: none; color: white; width: 100%; outline: none; font-size: 15px; }

        /* TABS (Pesta√±as) */
        .tabs { display: flex; justify-content: space-around; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .tab { padding: 12px 0; flex: 1; text-align: center; color: var(--gris); font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 14px; }
        .tab.active { color: var(--verde); border-bottom: 3px solid var(--verde); }

        /* CONTENEDOR DE P√ÅGINAS */
        #main-content { height: calc(100vh - 160px); overflow-y: auto; }

        /* MODAL DE AJUSTES (3 PUNTITOS) */
        .modal { 
            display: none; position: fixed; top: 45px; right: 10px; 
            background: #233138; box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
            border-radius: 8px; z-index: 1000; width: 200px; padding: 5px 0;
        }
        .modal-item { padding: 12px 20px; font-size: 15px; cursor: pointer; }
        .modal-item:hover { background: #182229; }

        /* BOT√ìN FLOTANTE */
        .fab { 
            position: fixed; bottom: 20px; right: 20px; background: var(--verde); 
            width: 55px; height: 55px; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; font-size: 24px; color: #0b141a;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-top">
            <div class="logo">DNPlus</div>
            <div class="icons">
                <span onclick="toggleSearch()">üîç</span>
                <span onclick="toggleModal()">‚ãÆ</span>
            </div>
        </div>

        <div class="search-bar" id="searchBar" style="display: none;">
            <input type="text" id="inputBusqueda" placeholder="Buscar..." oninput="ejecutarBusqueda()">
        </div>

        <div class="tabs">
            <div class="tab active" id="tab-chats" onclick="cargarSeccion('chats')">Chats</div>
            <div class="tab" id="tab-estados" onclick="cargarSeccion('estados')">Estados</div>
            <div class="tab" id="tab-llamadas" onclick="cargarSeccion('llamadas')">Llamadas</div>
        </div>
    </div>

    <div id="main-content"></div>

    <div id="ajustesModal" class="modal">
        <div class="modal-item" onclick="location.href='nuevo_grupo.html'">Nuevo grupo</div>
        <div class="modal-item" onclick="location.href='perfil.html'">Ajustes</div>
        <div class="modal-item" onclick="borrarHistorial()" style="color: #f15c5c;">Borrar historial chat</div>
    </div>

    <div class="fab" onclick="location.href='lista_contactos.html'">üí¨</div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD2nZF5QC-Zti80xP1A518qbUPnhRru_9A",
            databaseURL: "https://dnplus-messenger-pro-default-rtdb.firebaseio.com",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. CARGAR SECCIONES
        async function cargarSeccion(tipo) {
            const container = document.getElementById("main-content");
            
            // Actualizar Tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tipo).classList.add('active');

            // Cargar el archivo HTML correspondiente
            try {
                const response = await fetch(`lista_${tipo}.html`);
                const html = await response.text();
                container.innerHTML = html;

                // Ejecutar scripts que vengan dentro del HTML cargado
                const scripts = container.querySelectorAll("script");
                scripts.forEach(oldScript => {
                    const newScript = document.createElement("script");
                    newScript.text = oldScript.text;
                    document.body.appendChild(newScript).parentNode.removeChild(newScript);
                });
            } catch (err) {
                container.innerHTML = "<p style='text-align:center; padding:20px;'>Cargando secci√≥n...</p>";
            }
        }

        // 2. BUSCADOR REAL
        function toggleSearch() {
            const bar = document.getElementById("searchBar");
            bar.style.display = bar.style.display === "none" ? "flex" : "none";
        }

        function ejecutarBusqueda() {
            const texto = document.getElementById("inputBusqueda").value.toLowerCase();
            // Esto filtrar√° los elementos que tengan la clase 'chat-row', 'item', etc.
            const items = document.querySelectorAll(".chat-row, .item, .call-item");
            items.forEach(item => {
                const nombre = item.textContent.toLowerCase();
                item.style.display = nombre.includes(texto) ? "flex" : "none";
            });
        }

        // 3. MODAL AJUSTES
        function toggleModal() {
            const m = document.getElementById("ajustesModal");
            m.style.display = m.style.display === "block" ? "none" : "block";
        }

        function borrarHistorial() {
            if(confirm("¬øDavid, est√°s seguro de borrar todo tu historial de chats?")) {
                const miId = localStorage.getItem("user_temp_id");
                db.ref("chats_privados").once("value", snap => {
                    snap.forEach(child => {
                        if(child.key.includes(miId)) {
                            db.ref("chats_privados/" + child.key).remove();
                        }
                    });
                    alert("Historial borrado");
                    location.reload();
                });
            }
        }

        // Cerrar modal al tocar fuera
        window.onclick = function(event) {
            if (!event.target.matches('span')) {
                document.getElementById("ajustesModal").style.display = "none";
            }
        }

        // Cargar chats por defecto al abrir
        window.onload = () => cargarSeccion('chats');
    </script>
</body>
</html>
